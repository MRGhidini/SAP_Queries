CALL TREINAMENTO_HANA_TABELA_TEMPORARIA
DROP PROCEDURE "TREINAMENTO_HANA_TABELA_TEMPORARIA" ()
CREATE PROCEDURE "TREINAMENTO_HANA_TABELA_TEMPORARIA" ()
AS
BEGIN
CREATE LOCAL TEMPORARY TABLE #Customers (CardCode NVARCHAR(100), CardType NVARCHAR(1), Ativo NVARCHAR(1));
INSERT INTO #Customers(
	SELECT 
		 T0."CardCode"
		,T0."CardType" 
		,CASE
		    WHEN (T0."validFor" = 'Y' And CURRENT_DATE NOT BETWEEN IFNULL(T0."validFrom", ADD_DAYS(CURRENT_DATE, -1)) And IFNULL(T0."validTo", ADD_DAYS(CURRENT_DATE, 1))) THEN 'N'
		    WHEN (T0."frozenFor" = 'Y' And CURRENT_DATE BETWEEN IFNULL(T0."frozenFrom", ADD_DAYS(CURRENT_DATE, -1)) And IFNULL(T0."frozenTo", ADD_DAYS(CURRENT_DATE, 1))) THEN 'N'
		ELSE
	    	'Y'
		END "Ativo"
	FROM 
		"OCRD" T0);
DELETE FROM #Customers WHERE "ATIVO" <> 'Y' OR "CARDTYPE" <> 'C';

	Select 
		*
	From
		#Customers;
END;
